
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Footprint Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/jspdf@3.0.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sonner@1.5.0/dist/index.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
    // Importações e configurações simuladas
    const { jsPDF } = window.jspdf;
    const { Sonner } = window.Sonner;
    const { 
        BarChart, Bar, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer 
    } = Recharts;

    // Utilitários Carbon Calculations (simplificado)
    const getRecommendations = (emissionData) => {
        return emissionData.map(category => {
            switch(category.name) {
                case 'Transporte':
                    return 'Reduza o uso de transporte individual';
                case 'Energia':
                    return 'Economize energia em casa';
                case 'Alimentação':
                    return 'Prefira alimentos locais e de origem vegetal';
                case 'Compras':
                    return 'Compre de forma consciente e duradoura';
                case 'Resíduos':
                    return 'Recicle e reduza o desperdício';
                default:
                    return 'Adote práticas sustentáveis';
            }
        });
    };

    // Função de exportação de PDF
    const exportEmissionsToPDF = (emissionData, totalEmissions, goal) => {
        const doc = new jsPDF();
        
        doc.setFontSize(20);
        doc.text("Relatório de Pegada de Carbono", 20, 20);
        
        const today = new Date().toLocaleDateString('pt-BR');
        doc.setFontSize(10);
        doc.text(`Gerado em: ${today}`, 20, 30);
        
        doc.setFontSize(14);
        doc.text("Resumo de Emissões", 20, 40);
        
        doc.setFontSize(12);
        doc.text(`Emissão Total: ${totalEmissions.toFixed(1)} kg CO₂e`, 20, 50);
        doc.text(`Meta: ${goal} kg CO₂e`, 20, 60);
        
        doc.setFontSize(14);
        doc.text("Detalhamento por Categoria", 20, 75);
        
        let yPosition = 85;
        
        doc.setFontSize(10);
        doc.text("Categoria", 20, yPosition);
        doc.text("Emissões (kg CO₂e)", 90, yPosition);
        yPosition += 5;
        
        doc.line(20, yPosition, 180, yPosition);
        yPosition += 10;
        
        emissionData.forEach(category => {
            doc.text(category.name, 20, yPosition);
            doc.text(category.emissions.toFixed(1), 90, yPosition);
            yPosition += 10;
        });
        
        const recommendationsList = getRecommendations(emissionData);
        
        if (recommendationsList.length > 0) {
            yPosition += 10;
            doc.setFontSize(14);
            doc.text("Recomendações para Redução", 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(10);
            recommendationsList.forEach(rec => {
                const recText = typeof rec === 'object' && rec !== null ? rec.description : String(rec || '');
                doc.text(`• ${recText}`, 20, yPosition);
                yPosition += 7;
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
            });
        }
        
        doc.save("relatorio-pegada-carbono.pdf");
        alert("Relatório PDF gerado com sucesso!");
        
        return doc;
    };

    // Função para enviar PDF por email (simulado)
    const sendPDFByEmail = (email, emissionData, totalEmissions, goal) => {
        try {
            exportEmissionsToPDF(emissionData, totalEmissions, goal);
            alert(`PDF enviado para ${email} com sucesso!`);
            return true;
        } catch (error) {
            console.error("Erro ao enviar PDF por email:", error);
            alert("Não foi possível enviar o PDF por e-mail. Tente novamente.");
            return false;
        }
    };

    // Componentes React
    const Toast = ({ message, type = "success", onClose }) => {
        React.useEffect(() => {
            const timer = setTimeout(() => {
                onClose();
            }, 3000);
            return () => clearTimeout(timer);
        }, [onClose]);

        return (
            <div className={`fixed top-4 right-4 p-4 rounded-md shadow-md ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white`}>
                {message}
            </div>
        );
    };

    const Button = ({ children, onClick, className = "", variant = "primary" }) => {
        const baseClass = "px-4 py-2 rounded-md font-medium transition-colors";
        const variantClass = variant === "primary" 
            ? "bg-blue-500 text-white hover:bg-blue-600" 
            : variant === "danger"
            ? "bg-red-500 text-white hover:bg-red-600"
            : "bg-green-500 text-white hover:bg-green-600";

        return (
            <button 
                className={`${baseClass} ${variantClass} ${className}`}
                onClick={onClick}
            >
                {children}
            </button>
        );
    };

    const CategoryItem = ({ category, onDelete }) => {
        return (
            <li className="border-b py-3 flex justify-between items-center">
                <span>{category.name}: {category.emissions.toFixed(1)} kg CO₂e</span>
                <button 
                    onClick={() => onDelete(category)}
                    className="text-red-500 hover:text-red-700"
                >
                    &times;
                </button>
            </li>
        );
    };

    const EmissionsChart = ({ data }) => {
        return (
            <div className="h-64 w-full">
                <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={data}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="name" />
                        <YAxis label={{ value: 'kg CO₂e', angle: -90, position: 'insideLeft' }} />
                        <Tooltip />
                        <Legend />
                        <Bar dataKey="emissions" fill="#3B82F6" name="Emissões (kg CO₂e)" />
                    </BarChart>
                </ResponsiveContainer>
            </div>
        );
    };

    const EmailDialog = ({ isOpen, onClose, onSend }) => {
        const [email, setEmail] = React.useState("");

        if (!isOpen) return null;

        return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                <div className="bg-white p-6 rounded-lg w-full max-w-md">
                    <h2 className="text-xl font-semibold mb-4">Enviar Relatório por E-mail</h2>
                    <div className="mb-4">
                        <label className="block text-sm font-medium mb-1">E-mail</label>
                        <input 
                            type="email" 
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="w-full p-2 border rounded"
                            placeholder="seu@email.com"
                        />
                    </div>
                    <div className="flex justify-end space-x-2">
                        <button 
                            onClick={onClose}
                            className="px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300"
                        >
                            Cancelar
                        </button>
                        <button 
                            onClick={() => {
                                if (email && email.includes('@')) {
                                    onSend(email);
                                    onClose();
                                } else {
                                    alert("Por favor, insira um e-mail válido");
                                }
                            }}
                            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                        >
                            Enviar
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    const EcoTips = () => {
        return (
            <div className="bg-white p-6 rounded-lg shadow">
                <h2 className="text-xl font-semibold mb-4">Dicas Ecológicas</h2>
                <ul className="space-y-2 text-sm">
                    <li className="pb-2 border-b">
                        <strong>Transporte:</strong> Prefira transporte público, bicicleta ou caminhada quando possível.
                    </li>
                    <li className="pb-2 border-b">
                        <strong>Energia:</strong> Desligue aparelhos eletrônicos quando não estiver usando e troque para lâmpadas LED.
                    </li>
                    <li className="pb-2 border-b">
                        <strong>Alimentação:</strong> Reduza o consumo de carne e prefira alimentos locais da estação.
                    </li>
                    <li className="pb-2 border-b">
                        <strong>Compras:</strong> Evite produtos descartáveis e opte por itens duráveis e de qualidade.
                    </li>
                    <li>
                        <strong>Resíduos:</strong> Separe o lixo reciclável e tente compostar resíduos orgânicos.
                    </li>
                </ul>
            </div>
        );
    };

    // Componente principal
    const App = () => {
        const [emissionData, setEmissionData] = React.useState([
            { name: 'Transporte', emissions: 50 },
            { name: 'Energia', emissions: 100 },
            { name: 'Alimentação', emissions: 75 }
        ]);
        const [category, setCategory] = React.useState('');
        const [emissions, setEmissions] = React.useState('');
        const [showEmailDialog, setShowEmailDialog] = React.useState(false);
        const [toast, setToast] = React.useState(null);

        const totalEmissions = emissionData.reduce((sum, category) => sum + category.emissions, 0);
        const goal = 250;

        const handleCalculate = () => {
            if (category && emissions && !isNaN(parseFloat(emissions))) {
                const newCategory = {
                    name: category,
                    emissions: parseFloat(emissions)
                };
                const updatedEmissions = [...emissionData, newCategory];
                setEmissionData(updatedEmissions);
                setCategory('');
                setEmissions('');
                showToast("Emissão calculada e adicionada com sucesso!");
            } else {
                showToast("Por favor, preencha todos os campos corretamente.", "error");
            }
        };

        const handleDelete = (categoryToDelete) => {
            const updatedEmissions = emissionData.filter(item => item !== categoryToDelete);
            setEmissionData(updatedEmissions);
            showToast("Categoria removida com sucesso!");
        };

        const resetEmissionData = () => {
            if (confirm("Tem certeza que deseja limpar todos os dados?")) {
                setEmissionData([]);
                showToast("Dados resetados com sucesso!");
            }
        };

        const handleExportPDF = () => {
            exportEmissionsToPDF(emissionData, totalEmissions, goal);
        };

        const handleSendEmail = (email) => {
            sendPDFByEmail(email, emissionData, totalEmissions, goal);
        };

        const showToast = (message, type = "success") => {
            setToast({ message, type });
        };

        const hideToast = () => {
            setToast(null);
        };

        return (
            <div className="container mx-auto py-8 px-4">
                <header className="flex items-center space-x-2 mb-8">
                    <div className="h-10 w-10 rounded-lg bg-blue-500 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                        </svg>
                    </div>
                    <div>
                        <h1 className="text-2xl font-bold">Calculadora de Pegada de Carbono</h1>
                        <p className="text-gray-600">Meça e reduza seu impacto ambiental</p>
                    </div>
                </header>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-xl font-semibold mb-4">Calculadora de Emissões</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-1">Categoria</label>
                                <select 
                                    value={category}
                                    onChange={(e) => setCategory(e.target.value)}
                                    className="w-full p-2 border rounded"
                                >
                                    <option value="">Selecione uma categoria</option>
                                    <option value="Transporte">Transporte</option>
                                    <option value="Energia">Energia</option>
                                    <option value="Alimentação">Alimentação</option>
                                    <option value="Compras">Compras</option>
                                    <option value="Resíduos">Resíduos</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">Quantidade (kg CO₂e)</label>
                                <input 
                                    type="number" 
                                    value={emissions}
                                    onChange={(e) => setEmissions(e.target.value)}
                                    className="w-full p-2 border rounded"
                                    placeholder="Ex: 25"
                                    step="0.1"
                                />
                            </div>
                            <Button 
                                onClick={handleCalculate}
                                className="w-full"
                            >
                                Calcular Emissões
                            </Button>
                        </div>
                    </div>

                    <EcoTips />
                </div>

                <div className="mb-8 bg-white p-6 rounded-lg shadow">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-xl font-semibold">Resumo de Emissões</h2>
                        <div className="flex space-x-2">
                            <Button 
                                onClick={() => setShowEmailDialog(true)}
                                variant="primary"
                                className="text-sm"
                            >
                                Enviar por Email
                            </Button>
                            <Button 
                                onClick={handleExportPDF}
                                variant="success"
                                className="text-sm"
                            >
                                Exportar PDF
                            </Button>
                            <Button 
                                onClick={resetEmissionData}
                                variant="danger"
                                className="text-sm"
                            >
                                Resetar Dados
                            </Button>
                        </div>
                    </div>
                    
                    <div className="mb-4">
                        <p className="text-lg"><strong>Emissão Total:</strong> {totalEmissions.toFixed(1)} kg CO₂e</p>
                        <p className="text-lg"><strong>Meta:</strong> {goal} kg CO₂e</p>
                        <p className="text-lg">
                            <strong>Status:</strong> 
                            <span className={totalEmissions <= goal ? "text-green-500" : "text-red-500"}>
                                {totalEmissions <= goal ? " Dentro da meta" : " Acima da meta"}
                            </span>
                        </p>
                    </div>

                    <EmissionsChart data={emissionData} />
                </div>

                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-xl font-semibold mb-4">Categorias de Emissão</h2>
                    {emissionData.length > 0 ? (
                        <ul>
                            {emissionData.map((category, index) => (
                                <CategoryItem 
                                    key={index} 
                                    category={category} 
                                    onDelete={handleDelete} 
                                />
                            ))}
                        </ul>
                    ) : (
                        <p className="text-gray-500">Nenhuma categoria de emissão registrada ainda.</p>
                    )}
                </div>

                <EmailDialog 
                    isOpen={showEmailDialog}
                    onClose={() => setShowEmailDialog(false)}
                    onSend={handleSendEmail}
                />

                {toast && (
                    <Toast 
                        message={toast.message} 
                        type={toast.type}
                        onClose={hideToast}
                    />
                )}
            </div>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
